-- Replace ids with names in the occurs table to make it more readable
SELECT m.name as manager, s.name as student, w.name as write_up, o.dTime as assign_time
FROM occurs o
JOIN managers m ON o.mid = m.id
JOIN students s ON o.sid = s.id
JOIN writeUps w ON o.wid = w.id
ORDER BY o.dTime;

-- Number of times managers have used certain types of write ups
SELECT m.name as manager, w.name as write_up, COUNT(*)
FROM occurs o
JOIN managers m ON o.mid = m.id
JOIN writeUps w ON o.wid = w.id
GROUP BY m.name, w.name
ORDER BY w.name;

-- Number of times mangers have written up certain students:
SELECT m.name as manager, s.name as student, COUNT(*)
FROM occurs o
JOIN managers m ON o.mid = m.id
JOIN students s ON o.sid = s.id
GROUP BY m.name, s.name
ORDER BY s.name;

-- Number of different types of write ups each student received
SELECT s.name as student, w.name as write_up, COUNT(*)
FROM occurs o
JOIN students s ON o.sid = s.id
JOIN writeUps w ON o.wid = w.id
GROUP BY s.name, w.name
ORDER BY s.name;

-- Replace ids with names in the works table to make it more readable
SELECT s.name as student, d.name as day, w.strt as start, w.fnsh as finish, a.name as area, j.name as job
FROM works w
JOIN students s ON w.sid = s.id
JOIN days d ON w.did = d.id
JOIN areas a ON w.aid = a.id
JOIN jobs j ON w.jid = j.id
ORDER BY w.did, w.strt;

-- Get all write ups for all students that work together
SELECT m.name as manager, s.name as student, wr.name as write_up, o.dTime as assign_time, d.name as work_day, a.name as work_area, o.strt as work_time
FROM (SELECT o.mid, w.sid, o.wid, o.dTime, w.did, w.aid, w.strt
      FROM occurs o
      RIGHT JOIN (SELECT w1.sid, w1.did, w1.aid, w1.strt
                  FROM works w1
                  JOIN works w2 ON w1.aid = w2.aid AND w1.did = w2.did AND w1.strt = w2.strt AND NOT w1.sid = w2.sid) w
      ON o.sid = w.sid) o
LEFT JOIN managers m ON o.mid = m.id
LEFT JOIN students s ON o.sid = s.id
LEFT JOIN writeUps wr ON o.wid = wr.id
LEFT JOIN days d ON o.did = d.id
LEFT JOIN areas a ON o.aid = a.id
ORDER BY o.did, a.name, o.strt;

-- Get number of strikes for all students that work together
SELECT s.name as student, d.name as day, a.name as area, o.strt as time, COUNT(o.wid) as strikes
FROM (SELECT o.mid, w.sid, o.wid, o.dTime, w.did, w.aid, w.strt
      FROM occurs o
      RIGHT JOIN (SELECT w1.sid, w1.did, w1.aid, w1.strt
                  FROM works w1
                  JOIN works w2 ON w1.aid = w2.aid AND w1.did = w2.did AND w1.strt = w2.strt AND NOT w1.sid = w2.sid) w
      ON o.sid = w.sid) o
LEFT JOIN students s ON o.sid = s.id
LEFT JOIN days d ON o.did = d.id
LEFT JOIN areas a ON o.aid = a.id
GROUP BY s.name, d.name, a.name, o.strt
ORDER BY d.name, a.name, o.strt;

-- Get the schedules of students who have been put on the offenders table
SELECT s.name as student, d.name as day, w.strt as start, w.fnsh as finish, a.name as area, j.name as job, o.dTime as strike_date
FROM works w
JOIN offenders o ON w.sid = o.sid
JOIN students s ON w.sid = s.id
JOIN days d ON w.did = d.id
JOIN areas a ON w.aid = a.id
JOIN jobs j ON w.jid = j.id
ORDER BY w.did, w.strt;
